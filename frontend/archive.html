<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HabitTrack ‚Äî –ê—Ä—Ö—ñ–≤ –∑–≤–∏—á–æ–∫</title>
    <link rel="stylesheet" href="./style/main.css" />
    <link rel="stylesheet" href="./style/habits.css" />
    <style>
    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.8);
    }

    ::-webkit-scrollbar-thumb {
      background: #00ff88;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #00cc66;
    }
  </style>
  </head>

  <body>
    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
    <header class="navbar glass">
      <div class="logo">HabitTrack</div>
      <nav class="nav-links">
        <a href="./main.html">–ì–æ–ª–æ–≤–Ω–∞</a>
        <a href="./habits.html">–ó–≤–∏—á–∫–∏</a>
        <a href="./stats.html" class="active">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
        <a href="./archive.html" class="active">–ê—Ä—Ö—ñ–≤</a>
      </nav>
      <div class="auth-buttons" id="authButtons"></div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–∞ —Å–µ–∫—Ü—ñ—è -->
    <main class="section glass habits-section">
      <h1>–ê—Ä—Ö—ñ–≤ –∑–≤–∏—á–æ–∫</h1>
      <p class="subtitle">
        –¢—É—Ç –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç–≤–æ—ó –∞—Ä—Ö—ñ–≤–æ–≤–∞–Ω—ñ –∑–≤–∏—á–∫–∏. –¢–∏ –º–æ–∂–µ—à —ó—Ö –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∞–±–æ
        –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–∏—Ç–∏.
      </p>

      <div class="archive-grid" id="archiveList"></div>
    </main>

    <!-- –ü—ñ–¥–≤–∞–ª -->
    <footer class="footer glass">
      <p>¬© 2025 HabitTrack. –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.</p>
    </footer>

    <!-- JavaScript -->
    <script src="./js/auth.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const archiveList = document.getElementById("archiveList");
        let habits = JSON.parse(localStorage.getItem("habits")) || [];

        const saveHabits = () =>
          localStorage.setItem("habits", JSON.stringify(habits));

        const renderArchive = () => {
          archiveList.innerHTML = "";

          const archived = habits.filter((h) => h.archived);

          if (archived.length === 0) {
            archiveList.innerHTML = "<p>–ê—Ä—Ö—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π üí§</p>";
            return;
          }

          archived.forEach((habit) => {
            const card = document.createElement("div");
            card.className = "habit-card glass";
            card.innerHTML = `
            <div class="habit-header">
              <h3>${habit.name}</h3>
              <div class="habit-actions">
                <button title="–í—ñ–¥–Ω–æ–≤–∏—Ç–∏" onclick="restoreHabit('${
                  habit.id
                }')">‚ôªÔ∏è</button>
                <button title="–í–∏–¥–∞–ª–∏—Ç–∏" onclick="deleteHabit('${
                  habit.id
                }')">üóëÔ∏è</button>
              </div>
            </div>
            <p>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è: ${habit.type}</p>
            <p>–¶—ñ–ª—å: ${habit.goal} —Ä–∞–∑—ñ–≤/—Ç–∏–∂–¥–µ–Ω—å</p>
            ${
              habit.complex
                ? `<p>–°–∫–ª–∞–¥–Ω–∞ –∑–≤–∏—á–∫–∞: ${habit.timesPerDay} —Ä–∞–∑(–∏) –Ω–∞ –¥–µ–Ω—å</p>`
                : ""
            }
          `;
            archiveList.appendChild(card);
          });
        };

        // –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ –∑–≤–∏—á–∫—É
        window.restoreHabit = (id) => {
          const h = habits.find((h) => h.id === id);
          if (h) {
            h.archived = false;
            saveHabits();
            renderArchive();
            alert(`–ó–≤–∏—á–∫—É "${h.name}" –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ ‚úÖ`);
          }
        };

        // –ü–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–∏—Ç–∏
        window.deleteHabit = (id) => {
          if (confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –∑–≤–∏—á–∫—É –Ω–∞–∑–∞–≤–∂–¥–∏?")) {
            habits = habits.filter((h) => h.id !== id);
            saveHabits();
            renderArchive();
          }
        };

        renderArchive();
      });

      // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è / –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è
      document.addEventListener("DOMContentLoaded", () => {
        const authButtons = document.getElementById("authButtons");

        if (authService.isAuthenticated()) {
          const user = authService.getCurrentUser();
          authButtons.innerHTML = `
          <span class="user-greeting">–ü—Ä–∏–≤—ñ—Ç, ${user.username}!</span>
          <a href="./profile.html" class="btn btn-outline">–ü—Ä–æ—Ñ—ñ–ª—å</a>
          <button onclick="authService.logout()" class="btn btn-fill">–í–∏–π—Ç–∏</button>
        `;
        } else {
          authButtons.innerHTML = `
          <a href="./login.html" class="btn btn-outline">–£–≤—ñ–π—Ç–∏</a>
          <a href="./register.html" class="btn btn-fill">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a>
        `;
        }
      });
    </script>
  </body>
</html>
